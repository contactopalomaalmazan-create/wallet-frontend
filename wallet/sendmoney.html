<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Wallet - Enviar Dinero</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
    body {
      padding: 20px;
    }
    .container {
      max-width: 400px;
      margin: 0 auto;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>Enviar Dinero üí∏</h2>

    <p>Saldo disponible:</p>
    <h4 id="saldo">$0</h4>

    <hr>

    <select id="contacto" class="form-control">
      <option value="">Selecciona un contacto</option>
    </select>

    <br>

    <button id="btnNuevoContacto" class="btn btn-info btn-block">
      Agregar nuevo contacto
    </button>

    <div id="formContacto" style="display:none;" class="mt-3">
      <input type="text" id="nombre" class="form-control" placeholder="Nombre y apellido"><br>
      <input type="text" id="cbu" class="form-control" placeholder="CBU"><br>
      <input type="text" id="alias" class="form-control" placeholder="Alias"><br>
      <input type="text" id="banco" class="form-control" placeholder="Banco"><br>

      <button id="btnGuardarContacto" class="btn btn-success btn-block">
        Guardar contacto
      </button>
    </div>

    <hr>

    <input type="number" id="monto" class="form-control" placeholder="Monto a enviar"><br>

    <button id="btnEnviar" class="btn btn-danger btn-block">
      Enviar dinero
    </button>

    <br>
    <a href="menu.html" class="btn btn-secondary btn-block">
      Volver al men√∫
    </a>
  </div>

  <script>
    $(document).ready(function () {

      let saldo = Number(localStorage.getItem("saldo")) || 0;
      $("#saldo").text("$" + saldo);

      let contactos = JSON.parse(localStorage.getItem("contactos")) || [];

      contactos.forEach(c => {
        $("#contacto").append(
          `<option value="${c.nombre}">${c.nombre} - ${c.banco}</option>`
        );
      });

      $("#btnNuevoContacto").click(function () {
        $("#formContacto").slideToggle();
      });

      $("#btnGuardarContacto").click(function () {
        let contacto = {
          nombre: $("#nombre").val(),
          cbu: $("#cbu").val(),
          alias: $("#alias").val(),
          banco: $("#banco").val()
        };

        contactos.push(contacto);
        localStorage.setItem("contactos", JSON.stringify(contactos));
        alert("Contacto agregado");
        location.reload();
      });

      $("#btnEnviar").click(function () {
        let monto = Number($("#monto").val());
        let contacto = $("#contacto").val();

        if (!contacto || monto <= 0 || monto > saldo) {
          alert("Datos inv√°lidos o saldo insuficiente");
          return;
        }

        saldo -= monto;
        localStorage.setItem("saldo", saldo);

        let movimientos = JSON.parse(localStorage.getItem("movimientos")) || [];
        movimientos.push("Env√≠o de $" + monto + " a " + contacto);
        localStorage.setItem("movimientos", JSON.stringify(movimientos));

        alert("Dinero enviado con √©xito");
        window.location.href = "menu.html";
      });

    });
  </script>
</body>
</html>
